<% account.forEach(element => { %>
  <%investment = 0
 element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && entry.category.includes('Investment')))).forEach(entry => {
 investment += parseFloat(entry.amount*-1.00)
 })%>
  <%
  transactionCount = 0
  monthlyIncome = 0
  monthlyExpense = 0
  monthlyInvested = 0
   element.activity.filter(entry => (entry.isActive == true && (month == entry.tstamp.getMonth() && year  == entry.tstamp.getFullYear()))).forEach(entry => {
     transactionCount += 1
     if(!entry.isexpense && (!entry.category.includes('Debit') && !entry.category.includes('Credit')))
     {
       monthlyIncome += entry.amount
     }
     else if(entry.isexpense && (!entry.category.includes('Debit') && !entry.category.includes('Investment') && !entry.category.includes('Credit'))){
       monthlyExpense += entry.amount
     }
     else if(entry.isexpense && (entry.category.includes('Investment'))){
       monthlyInvested += entry.amount*-1.00
     }
  })

  yearlyIncome = 0
  yearlyExpense = 0
  yearlyInvested = 0
  element.activity.filter(entry => ((entry.isActive == true && (!entry.category.includes('Debit','Credit'))) && (year == entry.tstamp.getFullYear()))).forEach(entry => {
     
    if(!entry.isexpense && (!entry.category.includes('Debit') && !entry.category.includes('Credit')))
     {
       yearlyIncome += entry.amount
     }
     else if(entry.isexpense && (!entry.category.includes('Debit') && !entry.category.includes('Investment') && !entry.category.includes('Credit'))){
       yearlyExpense += entry.amount
     }
     else if(entry.isexpense && (entry.category.includes('Investment'))){
       yearlyInvested += entry.amount*-1.00
     }
  })
  %>  

<style>
  .modal { overflow: visible; }
.modal-body { overflow-y: visible !important; }
.income:hover span {display:none}
.income:hover:before {content:"100%"}
.invested:hover span {display:none}
.invested:hover:before {content:"<%=((investment)*100/element.income).toFixed(2)%>%"}
.expense:hover span {display:none}
.expense:hover:before {content:"<%=((element.expense)*100/element.income).toFixed(2)%>%"}
.balance:hover span {display:none}
.balance:hover:before {content:"<%=(100 - element.expense*100/element.income).toFixed(2)%>%"}
.monthlyincome:hover span {display:none}
.monthlyincome:hover:before {content:"100%"}
.monthlyinvested:hover span {display:none}
.monthlyinvested:hover:before {content:"<%=((monthlyIncome+monthlyExpense<=0)  && (monthlyIncome == 0)?0.00:(monthlyInvested)*100/monthlyIncome).toFixed(2)%>%"}
.monthlyexpense:hover span {display:none}
.monthlyexpense:hover:before {content:"<%=((monthlyIncome+monthlyExpense<=0.00) && (monthlyIncome == 0)?0.00:(monthlyExpense*-100/monthlyIncome)).toFixed(2)%>%"}
.monthlybalance:hover span {display:none}
.monthlybalance:hover:before {content:"<%=(monthlyIncome+monthlyExpense<=0.00?0.00:(100 - (monthlyExpense-monthlyInvested)*-100/monthlyIncome)).toFixed(2)%>%"}
.yearlyincome:hover span {display:none}
.yearlyincome:hover:before {content:"100%"}
.yearlyinvested:hover span {display:none}
.yearlyinvested:hover:before {content:"<%=((yearlyIncome+yearlyExpense<=0.00) && (yearlyIncome == 0)?0.00:(yearlyInvested)*100/yearlyIncome).toFixed(2)%>%"}
.yearlyexpense:hover span {display:none}
.yearlyexpense:hover:before {content:"<%=((yearlyIncome+yearlyExpense<=0.00) && (yearlyIncome == 0)?0.00:(yearlyExpense*-100/yearlyIncome)).toFixed(2)%>%"}
.yearlybalance:hover span {display:none}
.yearlybalance:hover:before {content:"<%=(yearlyIncome+yearlyExpense<=0.00?0.00:(100 - (yearlyExpense-yearlyInvested)*-100/yearlyIncome)).toFixed(2)%>%"}

</style>
 
    <%
    const monthCart = ["January","February","March","April","May","June","July","August","September","October","November","December"]
    const stockList = tickerStocks
  const stockValues = priceStocks
    %>
   <%
   const formatter = new Intl.NumberFormat('en-US', {
   style: 'currency',
   currency: element.currency,
   minimumFractionDigits: 2
   })
   const formatterDashboard = new Intl.NumberFormat('en-US', {
   style: 'currency',
   currency: element.currency,
   notation: "compact",
     compactDisplay: "short"
   })
   %>
 
  <div class="fixed-action-btn">
    <%      
              link = '/'+year+'/'+parseFloat(month+1)
              if(month == (new Date().getMonth()) && year == (new Date().getFullYear())){
                link = ''
              }
        %>
    <a class="btn-floating btn-large light-blue darken-4 pulse">
      <i class="large material-icons">layers</i>
    </a>
    <ul>
      <li><a title="Logout" data-toggle="modal" href="#logout" class="btn-floating black modal-trigger"><i class="material-icons">logout</i></a></li>
      <li><a title="Change Period" data-toggle="modal" href="#chperiod" class="btn-floating red modal-trigger"><i class="material-icons">today</i></a></li>
      <li><a title="Search" href="/account/<%=element._id%>/search" class="btn-floating teal modal-trigger"><i class="material-icons">search</i></a></li>    
      <li><a title="Chart Analytics" href="/account/<%=element._id%>/chart<%=link%>" class="btn-floating purple darken-1 modal-trigger"><i class="material-icons">analytics</i></a></li>
      <li><a title="Story" href="/account/<%=element._id%>/story<%=link%>" class="btn-floating blue-grey modal-trigger"><i class="material-icons">auto_stories</i></a></li>
      <li><a title="Asset Management" href="/account/<%=element._id%>/assets" class="btn-floating orange modal-trigger"><i class="material-icons">account_balance</i></a></li>   
    </ul>
  </div>
 
  <div class="section white" >
  <div class="row" style="margin-bottom: -10px;">
    <div class="col s1 left">
      <%
          link = element._id
          if(month != new Date().getMonth())
          {
            link = '../../'+element._id+'/'+year+'/'+parseFloat(month+1)
          }
      %>
      <a title = "Home" class="btn-floating btn-medium waves-effect waves-light blue darken-4" href="../<%=link%>"><i class="material-icons">roofing</i></a>
    </div>
  <div class="col s11">
          <h2 class="header center blue-text text-darken-4" style="font-family:Roboto; margin-bottom: -10px; margin-top: 0px; margin-right: 120px;">Pivots for <%=element.name%></h2>
    </div>
          
    </div>
  </div>
  <div class="container">
    <% 
              assetsWorth = 0
              element.asset.filter(entry => entry.isActive == true).forEach(entry => {
                if(entry.category == "Gold"){
                  assetPrice = priceGold*entry.units                  
                }
                else if(entry.category == "Silver"){
                  assetPrice = priceSilver*entry.units
                }
                else if(entry.category == "Equity"){
                  position = stockList.indexOf(entry.description)
                  assetPrice = stockValues[position]*entry.units
                }
                else if(entry.category == "Extra Charge"){
                  assetPrice = 0
                }
                else{
                  assetPrice = entry.tape*entry.units
                }
                assetsWorth += assetPrice
              })%>
    <div class="row">
      <div class="col s6" style="margin-bottom: -15px;">
        <div class="progress green lighten-4 tooltipped" data-position="left" data-tooltip="<%=((element.transum+element.onhold+assetsWorth-element.debt)/element.dnw*100).toFixed(2)%>% Goal Completed<br><%= formatterDashboard.format(element.transum+element.onhold+assetsWorth-element.debt)%> of <%=formatterDashboard.format(element.dnw)%>">
          <div class="determinate green darken-4" style=<%="width:"+(element.transum+element.onhold+assetsWorth-element.debt)/element.dnw*100+"%"%>></div>
      </div>
        </div>
        <div class="col s6" style="margin-bottom: -15px;">
          <%
            tday = new Date()
            bday = element.dob
            diff = Math.abs(tday - bday)
            diff = Math.ceil(diff / (1000 * 60 * 60 * 24)); 
            years = diff/365.25
            rdiff = element.aor*365.25
            percgoal = diff*100/rdiff
          %>
          <div class="progress red lighten-4 tooltipped" data-position="right" data-tooltip="<%=percgoal.toFixed(2)%>% Time Finished<br><%=years.toFixed(2)%> of <%=element.aor%> Years">
            <div class="determinate red darken-4" style=<%="width:"+ percgoal +"%"%>></div>
        </div>
          </div>
      </div>
                    <table class="striped centered responsive-table"style="margin-top:-30px">      
                        <thead>
                          <tr>
                            <th>Networth</th>
                            <th>Debt</th>
                            <th class = "income"><span>Income</span></th>
                            <th class = "expense"><span>Expense</span></th>
                              <th class = "invested"><span>Invested</span></th>
                              <th class = "balance"><span>Balance</span></th>
                              <th>Transactions</th>
                              <!--<th>On Hold</th>-->
                              <th>Unexplained</th>
                              
                          </tr>
                        </thead>
                        <tbody>
                          <tr style="font-weight:500;">
                            <td class="tooltipped" data-position="bottom" data-tooltip="<%=formatter.format(element.transum+element.onhold+assetsWorth-element.debt)%>"><%= formatterDashboard.format(element.transum+element.onhold+assetsWorth-element.debt)%></td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(element.debt)%>" class="tooltipped" ><%= formatterDashboard.format(element.debt)%></td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(element.income)%>" class = "tooltipped green-text text-darken-1"><%= formatterDashboard.format(element.income)%>&#9650;</td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(element.expense)%>" class = "tooltipped red-text text-darken-1"><%= formatterDashboard.format(element.expense)%>&#x25bc;</td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(investment)%>" class="tooltipped" ><%=formatterDashboard.format(investment)%></td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(element.currbal)%>" class="tooltipped" ><%= formatterDashboard.format(element.currbal)%></td>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(element.transum)%>" class="tooltipped" ><%= formatterDashboard.format(element.transum)%></td>
                            <!--<td data-position="bottom" data-tooltip="<%=formatter.format(element.onhold)%>" class="tooltipped" ><%= formatterDashboard.format(element.onhold)%></td>-->
                            <% variance = element.currbal-(element.transum+element.onhold)
                              if (variance < 0 && variance > -0.01)
                              {
                                variance *= -1.00
                              }
                            %>
                            <td data-position="bottom" data-tooltip="<%=formatter.format(variance)%>" class="tooltipped" ><%= formatterDashboard.format(variance)%></td>
                            
                           
                            
                          </tr>
                        </tbody>
                      </table>
               
            </div>
             
  
                
                 
              
               
              
              
          <div class="container">
            <div class="row">
              <div class="col s6">
                <table class="striped centered responsive-table">
                  <thead>
                            <tr>
                                <th><%=monthCart[month]%>
                      <hr>
                      </th>                    
                            </tr>
                          </thead>
                          <tbody>
                <table class="striped centered responsive-table" style="margin-top:-30px">      
                          <thead>
                            <tr>
                              <th class = "monthlyincome"><span>Credit</span></th>
                              <th class = "monthlyexpense"><span>Debit</span></th>
                              <th class = "monthlyinvested"><span>Invested</span></th>
                              <th class = "monthlybalance"><span>Balance</span></th>
                            </tr>
                          </thead>
                          <tbody>
    
                                    
                            <tr style="font-weight:500;">
                              
                              <td class = "green-text text-darken-1"><%= formatter.format(monthlyIncome)%>&#9650;</td>
                              <td class = "red-text text-darken-1"><%= formatter.format((monthlyExpense == 0)?monthlyExpense:monthlyExpense*-1)%>&#x25bc;</td>
                              <td><%= formatter.format(monthlyInvested)%></td>
                              <td><%= formatter.format(monthlyIncome+monthlyExpense>0?monthlyIncome+monthlyExpense-monthlyInvested:0.00)%></td>
                             
                              
                            </tr>
                          </tbody>
                        </table>
                      </tbody>
                      </table>
              </div>
              <div class="col s6">
                <table class="striped centered responsive-table">
                  <thead>
                            <tr>
                                <th><%=year%>
                      <hr>
                      </th>                    
                            </tr>
                          </thead>
                          <tbody>
                <table class="striped centered responsive-table" style="margin-top:-30px">      
                          <thead>
                            <tr>
                              <th class = "yearlyincome"><span>Credit</span></th>
                              <th class = "yearlyexpense"><span>Debit</span></th>
                              <th class = "yearlyinvested"><span>Invested</span></th>
                              <th class = "yearlybalance"><span>Balance</span></th>
                            </tr>
                          </thead>
                          <tbody>
    
                                    
                            <tr style="font-weight:500;">
                              
                              <td class = "green-text text-darken-1"><%= formatter.format(yearlyIncome)%>&#9650;</td>
                              <td class = "red-text text-darken-1"><%= formatter.format((yearlyExpense == 0)?yearlyExpense:yearlyExpense*-1)%>&#x25bc;</td>
                              <td><%= formatter.format(yearlyInvested)%></td>
                              <td><%= formatter.format(yearlyIncome+yearlyExpense>0?yearlyIncome+yearlyExpense-yearlyInvested:0.00)%></td>
                             
                              
                            </tr>
                          </tbody>
                        </table>
                      </tbody>
                      </table>
              </div>
            </div>
                 
              </div>
  
              
              <%
              
              categories = []
              balance = []
              monthlycategories = []
              monthlybalance = []
              yearlycategories = []
              yearlybalance = []
              element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && !entry.category.includes('Credit')))).forEach(entry => {
                if(!categories.includes(entry.category)){
                 categories.push(entry.category)
                    balance.push(0)
                }
                if(categories.includes(entry.category)){
                i = categories.indexOf(entry.category)
                    balance[i] += parseFloat(entry.amount*1.00)
                    }
              })
              
              element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && !entry.category.includes('Credit')) && (month == entry.tstamp.getMonth() && year == entry.tstamp.getFullYear()))).forEach(entry => {
                if(!monthlycategories.includes(entry.category)){
                 monthlycategories.push(entry.category)
                    monthlybalance.push(0)
                }
                if(monthlycategories.includes(entry.category)){
                i = monthlycategories.indexOf(entry.category)
                    monthlybalance[i] += parseFloat(entry.amount*1.00)
                    }
              })

              element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && !entry.category.includes('Credit')) && (year == entry.tstamp.getFullYear()))).forEach(entry => {
                if(!yearlycategories.includes(entry.category)){
                 yearlycategories.push(entry.category)
                    yearlybalance.push(0)
                }
                if(yearlycategories.includes(entry.category)){
                i = yearlycategories.indexOf(entry.category)
                    yearlybalance[i] += parseFloat(entry.amount*1.00)
                    }
              })
              %>  
              <div class="container">
                <ul class="collapsible">
    <li>
      <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">redeem</i>Categorywise Income</h5></div>
      <div class="collapsible-body">
        <div class="row">
          <%if(monthlyIncome > 0){%>
          <div class="col s4">
            <table class="striped centered responsive-table">
              <thead>
                        <tr>
                            <th><%=monthCart[month]%>
                  <hr>
                  </th>                    
                        </tr>
                      </thead>
                      <tbody>
            <table class="striped centered responsive-table" style="margin-top:-30px">      
                      <thead>
                        <tr>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Percent</th>
                            
                        </tr>
                      </thead>
                      <tbody>

                                
                        <%monthlycategories.forEach((monthlycategory,index) => {%>
                        <tr style="font-weight:500;">
                            <td><%=monthlycategory%></td>    
                            <td><%=formatter.format(monthlybalance[index])%></td>    
                            <td><%=(monthlybalance[index]*100/monthlyIncome).toFixed(2)%></td>
                          <%})%>                              
                        </tr>
                      </tbody>
                    </table>
                  </tbody>
                  </table>
          </div><%}%>
          <%yearGrid = "s4"
          if(monthlyIncome <= 0)
          {
            yearGrid = "s6"
          }
          %>
          <%if(yearlyIncome > 0){%>
          <div class="col <%=yearGrid%>">
            <table class="striped centered responsive-table">
              <thead>
                        <tr>
                            <th><%=year%>
                  <hr>
                  </th>                    
                        </tr>
                      </thead>
                      <tbody>
            <table class="striped centered responsive-table" style="margin-top:-30px">      
                      <thead>
                        <tr>
                          <th>Category</th>
                          <th>Amount</th>
                          <th>Percent</th>
                        </tr>
                      </thead>
                      <tbody>

                                
                        <%yearlycategories.forEach((yearlycategory,index) => {%>
                        <tr style="font-weight:500;">
                            <td><%=yearlycategory%></td>    
                            <td><%=formatter.format(yearlybalance[index])%></td>    
                            <td><%=(yearlybalance[index]*100/yearlyIncome).toFixed(2)%></td>
                          <%})%>                              
                        </tr>
                      </tbody>
                    </table>
                  </tbody>
                  </table>
          </div>
          <%}%>
          <%Grid = "s4"
          if(monthlyIncome <= 0)
          {
            Grid = "s6"
          }
          if(yearlyIncome <= 0)
          {
            Grid = "s12"
          }
          %>
          <div class="col <%=Grid%>">

            <table class="striped centered responsive-table">
              <thead>
                        <tr>
                            <th>Lifetime
                  <hr>
                  </th>                    
                        </tr>
                      </thead>
                      <tbody>
            <table class="striped centered responsive-table" style="margin-top:-30px">      
                      <thead>
                        <tr>
                          <th>Category</th>
                          <th>Amount</th>
                          <th>Percent</th>
                        </tr>
                      </thead>
                      <tbody>
                        <%if(element.tcreate.getFullYear() == 2021 && element.tcreate.getMonth() == 10 && element.tcreate.getDate() == 12 && element.name == "Prateek"){%>
                          <tr style="font-weight:500;">
                            <td>Unaccounted</td>
                            <td><%=formatter.format(element.uincome)%></td>
                            <td><%=(element.uincome*100/element.income).toFixed(2)%></td>
                          </tr>
                          <%}%>
                        <%categories.forEach((category,index) => {%>
                        <tr style="font-weight:500;">
                            <td><%=category%></td>    
                            <td><%=formatter.format(balance[index])%></td>    
                            <td><%=(balance[index]*100/element.income).toFixed(2)%></td>                                
                          <%})%>                              
                        </tr>
                      </tbody>
                    </table>
                  </tbody>
                  </table>
          </div>
        </div>
             </div>
                      </li>
                      
              
              
              <%
              
              categories = []
              balance = []
              monthlycategories = []
              monthlybalance = []
              yearlycategories = []
              yearlybalance = []
              element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && !entry.category.includes('Debit')))).forEach(entry => {
                if(!categories.includes(entry.category)){
                 categories.push(entry.category)
                    balance.push(0)
                }
                if(categories.includes(entry.category)){
                i = categories.indexOf(entry.category)
                    balance[i] += parseFloat(entry.amount*-1.00)
                    }
              })
              
              element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && !entry.category.includes('Debit')) && (month == entry.tstamp.getMonth() && year == entry.tstamp.getFullYear()))).forEach(entry => {
                if(!monthlycategories.includes(entry.category)){
                 monthlycategories.push(entry.category)
                    monthlybalance.push(0)
                }
                if(monthlycategories.includes(entry.category)){
                i = monthlycategories.indexOf(entry.category)
                    monthlybalance[i] += parseFloat(entry.amount*-1.00)
                    }
              })

              element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && !entry.category.includes('Debit')) && (year == entry.tstamp.getFullYear()))).forEach(entry => {
                if(!yearlycategories.includes(entry.category)){
                 yearlycategories.push(entry.category)
                    yearlybalance.push(0)
                }
                if(yearlycategories.includes(entry.category)){
                i = yearlycategories.indexOf(entry.category)
                    yearlybalance[i] += parseFloat(entry.amount*-1.00)
                    }
              })
              %>  
              <%if(element.expense > 0){%>
                <li>
                  <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">shopping_cart</i>Categorywise Expense</h5></div>
                  <div class="collapsible-body">
                        <div class="row">
                          <%if(monthlyExpense < 0){%>
                          <div class="col s4">
                            <table class="striped centered responsive-table">
                              <thead>
                                        <tr>
                                            <th><%=monthCart[month]%>
                                  <hr>
                                  </th>                    
                                        </tr>
                                      </thead>
                                      <tbody>
                            <table class="striped centered responsive-table" style="margin-top:-30px">      
                                      <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Amount</th>
                                            <th>Percent</th>
                                            
                                        </tr>
                                      </thead>
                                      <tbody>
                
                                                
                                        <%monthlycategories.forEach((monthlycategory,index) => {%>
                                        <tr style="font-weight:500;">
                                            <td><%=monthlycategory%></td>    
                                            <td><%=formatter.format(monthlybalance[index])%></td>    
                                            <td><%=(monthlybalance[index]*-100/(monthlyExpense-monthlyInvested)).toFixed(2)%></td>
                                          <%})%>                              
                                        </tr>
                                      </tbody>
                                    </table>
                                  </tbody>
                                  </table>
                          </div><%}%>
                          <%yearGrid = "s4"
                          if(monthlyExpense >= 0)
                          {
                            yearGrid = "s6"
                          }
                          %>
                          <%if(yearlyExpense < 0){%>
                          <div class="col <%=yearGrid%>">
                            <table class="striped centered responsive-table">
                              <thead>
                                        <tr>
                                            <th><%=year%>
                                  <hr>
                                  </th>                    
                                        </tr>
                                      </thead>
                                      <tbody>
                            <table class="striped centered responsive-table" style="margin-top:-30px">      
                                      <thead>
                                        <tr>
                                          <th>Category</th>
                                          <th>Amount</th>
                                          <th>Percent</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                
                                                
                                        <%yearlycategories.forEach((yearlycategory,index) => {%>
                                        <tr style="font-weight:500;">
                                            <td><%=yearlycategory%></td>    
                                            <td><%=formatter.format(yearlybalance[index])%></td>    
                                            <td><%=(yearlybalance[index]*-100/(yearlyExpense-yearlyInvested)).toFixed(2)%></td>
                                          <%})%>                              
                                        </tr>
                                      </tbody>
                                    </table>
                                  </tbody>
                                  </table>
                          </div>
                          <%}%>
                          <%Grid = "s4"
                          if(monthlyExpense >= 0)
                          {
                            Grid = "s6"
                          }
                          if(yearlyExpense >= 0)
                          {
                            Grid = "s12"
                          }
                          %>
                          <div class="col <%=Grid%>">
                
                            <table class="striped centered responsive-table">
                              <thead>
                                        <tr>
                                            <th>Lifetime
                                  <hr>
                                  </th>                    
                                        </tr>
                                      </thead>
                                      <tbody>
                            <table class="striped centered responsive-table" style="margin-top:-30px">      
                                      <thead>
                                        <tr>
                                          <th>Category</th>
                                          <th>Amount</th>
                                          <th>Percent</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <%if(element.tcreate.getFullYear() == 2021 && element.tcreate.getMonth() == 10 && element.tcreate.getDate() == 12 && element.name == "Prateek"){%>
                                          <tr style="font-weight:500;">
                                            <td>Unaccounted</td>
                                            <td><%=formatter.format(element.uexpense)%></td>
                                            <td><%=(element.uexpense*100/(element.expense - investment)).toFixed(2)%></td>
                                          </tr>
                                          <%}%>
                                        <%categories.forEach((category,index) => {%>
                                        <tr style="font-weight:500;">
                                            <td><%=category%></td>    
                                            <td><%=formatter.format(balance[index])%></td>    
                                            <td><%=(balance[index]*100/(element.expense - investment)).toFixed(2)%></td>                                
                                          <%})%>                              
                                        </tr>
                                      </tbody>
                                    </table>
                                  </tbody>
                                  </table>
                          </div>
                        </div>
                             </div>
                             </li>
              <%}%>

                 <%

                           months = [0,1,2,3,4,5,6,7,8,9,10,11]
                           balance = [0,0,0,0,0,0,0,0,0,0,0,0]
                           years = []
                           yearBalance = []
                           payMonth = 0
                           element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && (year == entry.tstamp.getFullYear() && !entry.category.includes('Credit'))))).forEach(entry => {
                             /*if(!months.includes(entry.tstamp.getMonth())){
                              months.push(entry.tstamp.getMonth())
                                 balance.push(0)
                             }*/
                             if(months.includes(entry.tstamp.getMonth())){
                             i = months.indexOf(entry.tstamp.getMonth())
                                 balance[i] += parseFloat(entry.amount*1.00)
                                 }

                                
                             
                           })

                           for (x = 0;x < balance.length;x++)
                           {
                            if (balance[x] != 0)
                            {
                              payMonth += 1
                            }
                           }

                           element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && !entry.category.includes('Credit')))).forEach(entry => {
                            
             
                                 if(!years.includes(entry.tstamp.getFullYear())){
                              years.push(entry.tstamp.getFullYear())
                                 yearBalance.push(0)
                             }
                             if(years.includes(entry.tstamp.getFullYear())){
                             i = years.indexOf(entry.tstamp.getFullYear())
                                 yearBalance[i] += parseFloat(entry.amount*1.00)
                                 }
                             
                           })
             
                              %>
                               
                           <li>
                             <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">trending_up</i>Periodwise Income</h5></div>
                             <div class="collapsible-body">
                                   <div class="row">
                                     <%yearGrid = "s6" %>
                                     <%if(yearlyIncome > 0){%>
                                     <div class="col <%=yearGrid%>">
                                       <table class="striped centered responsive-table">
                                         <thead>
                                                   <tr>
                                                       <th><%=year%>
                                             <hr>
                                             </th>                    
                                                   </tr>
                                                 </thead>
                                                 <tbody>
                                       <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                 <thead>
                                                   <tr>
                                                     <th>Month</th>
                                                     <th>Amount</th>
                                                     <th>Percent</th>
                                                   </tr>
                                                 </thead>
                                                 <tbody>
                           
                                                  <tr style="font-weight:500;">
                                                    <td>Average</td>    
                                                     <td><%=formatter.format(yearlyIncome/payMonth)%></td>    
                                                     <td><%=(100/payMonth).toFixed(2)%></td>
                                                 </tr>
                                                   <%months.forEach((month,index) => {%>
                                                   <tr style="font-weight:500;">
                                                       <td><%=monthCart[month]%></td>    
                                                       <td><%=formatter.format(balance[index])%></td>    
                                                       <td><%=(balance[index]*100/yearlyIncome).toFixed(2)%></td>
                                                     <%})%>                              
                                                   </tr>
                                                  
                                                 </tbody>
                                               </table>
                                             </tbody>
                                             </table>
                                     </div>
                                     <%}%>
                                     <%Grid = "s6"
                                     if(yearlyIncome == 0)
                                     {
                                       Grid = "s12"
                                     }
                                     %>
                                     <div class="col <%=Grid%>">
                           
                                       <table class="striped centered responsive-table">
                                         <thead>
                                                   <tr>
                                                       <th>Lifetime
                                             <hr>
                                             </th>                    
                                                   </tr>
                                                 </thead>
                                                 <tbody>
                                       <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                 <thead>
                                                   <tr>
                                                     <th>Year</th>
                                                     <th>Amount</th>
                                                     <th>Percent</th>
                                                   </tr>
                                                 </thead>
                                                 <tbody>
                                                  <%if(element.tcreate.getFullYear() == 2021 && element.tcreate.getMonth() == 10 && element.tcreate.getDate() == 12 && element.name == "Prateek"){%>
                                                    <tr style="font-weight:500;">
                                                      <td>Unaccounted</td>
                                                      <td><%=formatter.format(element.uincome)%></td>
                                                      <td><%=(element.uincome*100/element.income).toFixed(2)%></td>
                                                    </tr>
                                                    <%}%>
                                                    <tr style="font-weight:500;">
                                                      <td>Average </td>    
                                                      <td><%=formatter.format(element.income/((new Date().getTime() - new Date("06/03/2019").getTime())/(1000 * 60 * 60 * 24 * 30.4375 * 12)).toFixed(2))%></td>    
                                                      <td><%=(100/((new Date().getTime() - new Date("06/03/2019").getTime())/(1000 * 60 * 60 * 24 * 30.4375 * 12))).toFixed(2)%></td>                                
                                                                                
                                                  </tr>
                                                   <%years.forEach((year,index) => {%>
                                                   <tr style="font-weight:500;">
                                                       <td><%=year%></td>    
                                                       <td><%=formatter.format(yearBalance[index])%></td>    
                                                       <td><%=(yearBalance[index]*100/element.income).toFixed(2)%></td>                                
                                                     <%})%>                              
                                                   </tr>
                                                 </tbody>
                                               </table>
                                             </tbody>
                                             </table>
                                     </div>
                                   </div>
                                        </div>
                                        </li>
                                        <%

                           months = []
                           balance = []
                           years = []
                           yearBalance = []
                           Investment = 0
                           yearInvestment = 0
                           element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && (year == entry.tstamp.getFullYear() && entry.category.includes('Investment'))))).forEach(entry => {
                             yearInvestment += parseFloat(entry.amount*-1.00)
                             if(!months.includes(entry.tstamp.getMonth())){
                              months.push(entry.tstamp.getMonth())
                                 balance.push(0)
                             }
                             if(months.includes(entry.tstamp.getMonth())){
                             i = months.indexOf(entry.tstamp.getMonth())
                                 balance[i] += parseFloat(entry.amount*-1.00)
                                 }
             
                              
                             
                           })
                           element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && entry.category.includes('Investment')))).forEach(entry => {
                            Investment += parseFloat(entry.amount*-1.00)
             
                                 if(!years.includes(entry.tstamp.getFullYear())){
                              years.push(entry.tstamp.getFullYear())
                                 yearBalance.push(0)
                             }
                             if(years.includes(entry.tstamp.getFullYear())){
                             i = years.indexOf(entry.tstamp.getFullYear())
                                 yearBalance[i] += parseFloat(entry.amount*-1.00)
                                 }
                             
                           })
             
                              %>
                               
                           <%if(yearBalance.length > 0){%>
                            <li>
                              <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">developer_board</i>Periodwise Investment</h5></div>
                              <div class="collapsible-body">
                                    <div class="row">
                                      <%yearGrid = "s6" %>
                                      <%if(yearlyExpense < 0){%>
                                      <div class="col <%=yearGrid%>">
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th><%=year%>
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Month</th>
                                                      <th>Amount</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                            
                                                            
                                                    <%months.forEach((month,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=monthCart[month]%></td>    
                                                        <td><%=formatter.format(balance[index])%></td>    
                                                        <td><%=(balance[index]*100/yearInvestment).toFixed(2)%></td>
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                      <%}%>
                                      <%Grid = "s6"
                                      if(yearlyExpense >= 0)
                                      {
                                        Grid = "s12"
                                      }
                                      %>
                                      <div class="col <%=Grid%>">
                            
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th>Lifetime
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Year</th>
                                                      <th>Amount</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <%years.forEach((year,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=year%></td>    
                                                        <td><%=formatter.format(yearBalance[index])%></td>    
                                                        <td><%=(yearBalance[index]*100/Investment).toFixed(2)%></td>                                
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                    </div>
                                         </div>
                                         </li>
                              <%}%>          
                                        

                 <%

              monthsIncome = [0,1,2,3,4,5,6,7,8,9,10,11]
              incomeMonth = [0,0,0,0,0,0,0,0,0,0,0,0]
              monthsExpense = [0,1,2,3,4,5,6,7,8,9,10,11]
              expenseMonth = [0,0,0,0,0,0,0,0,0,0,0,0]
              yearsIncome = []
              incomeYear = []
              yearsExpense = []
              expenseYear = []
              
              element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && (year == entry.tstamp.getFullYear() && !entry.category.includes('Debit'))))).forEach(entry => {
                /*if(!monthsExpense.includes(entry.tstamp.getMonth())){
                 monthsExpense.push(entry.tstamp.getMonth())
                    expenseMonth.push(0)
                }*/
                if(monthsExpense.includes(entry.tstamp.getMonth())){
                i = monthsExpense.indexOf(entry.tstamp.getMonth())
                    expenseMonth[i] += parseFloat(entry.amount*-1.00)
                    }

                     
                  
                  })
              element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && !entry.category.includes('Debit')))).forEach(entry => {
               

                    if(!yearsExpense.includes(entry.tstamp.getFullYear())){
                 yearsExpense.push(entry.tstamp.getFullYear())
                    expenseYear.push(0)
                }
                if(yearsExpense.includes(entry.tstamp.getFullYear())){
                i = yearsExpense.indexOf(entry.tstamp.getFullYear())
                    expenseYear[i] += parseFloat(entry.amount*-1.00)
                    }   
                  
                  })

                  element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && (year == entry.tstamp.getFullYear() && !entry.category.includes('Credit'))))).forEach(entry => {
                /*if(!monthsIncome.includes(entry.tstamp.getMonth())){
                 monthsIncome.push(entry.tstamp.getMonth())
                    incomeMonth.push(0)
                }*/
                if(monthsIncome.includes(entry.tstamp.getMonth())){
                i = monthsIncome.indexOf(entry.tstamp.getMonth())
                    incomeMonth[i] += parseFloat(entry.amount*1.00)
                    }
                  
                
              })

                    element.activity.filter(entry => (((entry.isActive == true && !entry.isexpense) && !entry.category.includes('Credit')))).forEach(entry => {
               
                    if(!yearsIncome.includes(entry.tstamp.getFullYear())){
                 yearsIncome.push(entry.tstamp.getFullYear())
                    incomeYear.push(0)
                }
                if(yearsIncome.includes(entry.tstamp.getFullYear())){
                i = yearsIncome.indexOf(entry.tstamp.getFullYear())
                    incomeYear[i] += parseFloat(entry.amount*1.00)
                    }
                  
                
              })
              monthsIterator = monthsIncome.length == monthsExpense.length?monthsExpense:monthsIncome.length > monthsExpense.length?monthsIncome:monthsExpense
              if(monthsIncome.length == monthsExpense.length){
              monthsBig = monthsIncome.length > monthsExpense.length?monthsIncome.length:monthsExpense.length
              monthsSmall = monthsIncome.length < monthsExpense.length?monthsIncome.length:monthsExpense.length
              whichMonth = monthsIncome.length < monthsExpense.length?true:false
              for(i = monthsSmall;i<monthsBig;i++)
              {
                if(whichMonth)
                {
                  incomeMonth[i] = 0
                }
                else{
                  expenseMonth[i] = 0
                }
              }
              }

              yearsIterator = yearsIncome.length == yearsExpense.length?yearsExpense:yearsIncome.length > yearsExpense.length?yearsIncome:yearsExpense
              if(yearsIncome.length == yearsExpense.length){
              yearsBig = yearsIncome.length > yearsExpense.length?yearsIncome.length:yearsExpense.length
              yearsSmall = yearsIncome.length < yearsExpense.length?yearsIncome.length:yearsExpense.length
              whichYear = yearsIncome.length < yearsExpense.length?true:false
              for(i = yearsSmall;i<yearsBig;i++)
              {
                if(whichYear)
                {
                  incomeYear[i] = 0
                }
                else{
                  expenseYear[i] = 0
                }
              }
              }
                 %>

                 

              <li>
                <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">savings</i>Periodwise Savings</h5></div>
                <div class="collapsible-body">
                      <div class="row">
                        <%yearGrid = "s6" %>
                        <%if(yearlyIncome > 0){%>
                        <div class="col <%=yearGrid%>">
                          <table class="striped centered responsive-table">
                            <thead>
                                      <tr>
                                          <th><%=year%>
                                <hr>
                                </th>                    
                                      </tr>
                                    </thead>
                                    <tbody>
                          <table class="striped centered responsive-table" style="margin-top:-30px">      
                                    <thead>
                                      <tr>
                                        <th>Month</th>
                                        <th>Amount</th>
                                        <th>Percent*</th>
                                      </tr>
                                    </thead>
                                    <tbody>
              
                                              
                                      <%monthsIterator.forEach((month,index) => {%>
                                        <%if(!expenseMonth[index]){
                                          expenseMonth[index] = 0
                                        }
                                        if(!incomeMonth[index]){
                                          incomeMonth[index] = 0
                                        }
                                        %>
                                      <tr style="font-weight:500;">
                                          <td><%=monthCart[month]%></td>    
                                          <td><%=formatter.format((incomeMonth[index]-expenseMonth[index])>0?(incomeMonth[index]-expenseMonth[index]):0.00)%></td>    
                                          <td><%=(((incomeMonth[index]-expenseMonth[index])>0?(incomeMonth[index]-expenseMonth[index]):0.00)*100/incomeMonth[index]).toFixed(2)%></td>
                                        <%})%>                              
                                      </tr>
                                    </tbody>
                                  </table>
                                </tbody>
                                </table>
                        </div>
                        <%}%>
                        <%Grid = "s6"
                        if(yearlyIncome == 0)
                        {
                          Grid = "s12"
                        }
                        %>
                        <div class="col <%=Grid%>">
              
                          <table class="striped centered responsive-table">
                            <thead>
                                      <tr>
                                          <th>Lifetime
                                <hr>
                                </th>                    
                                      </tr>
                                    </thead>
                                    <tbody>
                          <table class="striped centered responsive-table" style="margin-top:-30px">      
                                    <thead>
                                      <tr>
                                        <th>Year</th>
                                        <th>Amount</th>
                                        <th>Percent*</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <%if(element.tcreate.getFullYear() == 2021 && element.tcreate.getMonth() == 10 && element.tcreate.getDate() == 12 && element.name == "Prateek"){%>
                                        <tr style="font-weight:500;">
                                          <td>2019</td>
                                          <td><%=formatter.format(0)%></td>
                                          <td><%=(0).toFixed(2)%></td>
                                        </tr>
                                        <tr style="font-weight:500;">
                                          <td>2020</td>
                                          <td><%=formatter.format(0)%></td>
                                          <td><%=(0).toFixed(2)%></td>
                                        </tr>
                                        <%}%>
                                      <%yearsIterator.forEach((year,index) => {%>
                                        <%if(!expenseYear[index]){
                                          expenseYear[index] = 0
                                        }%>
                                      <tr style="font-weight:500;">
                                          <td><%=year%></td>    
                                          <td><%=formatter.format((incomeYear[index]-expenseYear[index])>0?incomeYear[index]-expenseYear[index]:0.00)%></td>    
                                          <td><%=((incomeYear[index]-expenseYear[index])>0?((incomeYear[index]-expenseYear[index])*100/incomeYear[index]):0.00).toFixed(2)%></td>
                                        <%})%>                              
                                      </tr>
                                    </tbody>
                                  </table>
                                </tbody>
                                
                                </table>
                                
                        </div>
                        
                      </div>
                      <p>*Percent of Income</p>
                           </div>
                           </li>
                           <%
                           months = [0,1,2,3,4,5,6,7,8,9,10,11]
                           balance = [0,0,0,0,0,0,0,0,0,0,0,0]
                           years = []
                           yearBalance = []
                           yearlyInvestment = 0
                           spendMonth = 0
                           element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && (entry.category.includes('Investment') && year == entry.tstamp.getFullYear())))).forEach(entry => {
                             yearlyInvestment += parseFloat(entry.amount*-1.00)
                           })
                           element.activity.filter(entry => (((entry.isActive == true && entry.isexpense && year == entry.tstamp.getFullYear()) && (!entry.category.includes('Investment') && !entry.category.includes('Debit'))))).forEach(entry => {
                             /*if(!months.includes(entry.tstamp.getMonth())){
                              months.push(entry.tstamp.getMonth())
                                 balance.push(0)
                             }*/
                             if(months.includes(entry.tstamp.getMonth())){
                             i = months.indexOf(entry.tstamp.getMonth())
                                 balance[i] += parseFloat(entry.amount*-1.00)
                                 }                
                           })

                           for (x = 0;x < balance.length;x++)
                           {
                            if (balance[x] != 0)
                            {
                              spendMonth += 1
                            }
                           }
                           element.activity.filter(entry => (((entry.isActive == true && entry.isexpense) && (!entry.category.includes('Investment') && !entry.category.includes('Debit'))))).forEach(entry => {
                            
             
                                 if(!years.includes(entry.tstamp.getFullYear())){
                              years.push(entry.tstamp.getFullYear())
                                 yearBalance.push(0)
                             }
                             if(years.includes(entry.tstamp.getFullYear())){
                             i = years.indexOf(entry.tstamp.getFullYear())
                                 yearBalance[i] += parseFloat(entry.amount*-1.00)
                                 }
                             
                           })
             
                              %>
                               
                          <%if(yearBalance.length > 0){%>
                            <li>
                              <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">trending_down</i>Periodwise Expense</h5></div>
                              <div class="collapsible-body">
                                    <div class="row">
                                      <%yearGrid = "s6" %>
                                      <%if(yearlyExpense < 0){%>
                                      <div class="col <%=yearGrid%>">
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th><%=year%>
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Month</th>
                                                      <th>Amount</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <tr style="font-weight:500;">
                                                      <td>Average</td>    
                                                      <td><%=formatter.format(-1.00*yearlyExpense/spendMonth)%></td>    
                                                      <td><%=(100/spendMonth).toFixed(2)%></td>
                                                                                 
                                                  </tr>
                                                            
                                                    <%months.forEach((month,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=monthCart[month]%></td>    
                                                        <td><%=formatter.format(balance[index])%></td>    
                                                        <td><%=(balance[index]*-100/(yearlyExpense)).toFixed(2)%></td>
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                      <%}%>
                                      <%Grid = "s6"
                                      if(yearlyExpense >= 0)
                                      {
                                        Grid = "s12"
                                      }
                                      %>
                                      <div class="col <%=Grid%>">
                            
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th>Lifetime
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Year</th>
                                                      <th>Amount</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                   <%if(element.tcreate.getFullYear() == 2021 && element.tcreate.getMonth() == 10 && element.tcreate.getDate() == 12 && element.name == "Prateek"){%>
                                                     <tr style="font-weight:500;">
                                                       <td>Unaccounted</td>
                                                       <td><%=formatter.format(element.uexpense)%></td>
                                                       <td><%=(element.uexpense*100/(element.expense - investment)).toFixed(2)%></td>
                                                     </tr>
                                                     <%}%>

                                                     <tr style="font-weight:500;">
                                                      <td>Average </td>    
                                                      <td><%=formatter.format(element.expense/((new Date().getTime() - new Date("06/03/2019").getTime())/(1000 * 60 * 60 * 24 * 30.4375 * 12)).toFixed(2))%></td>    
                                                      <td><%=(100/((new Date().getTime() - new Date("06/03/2019").getTime())/(1000 * 60 * 60 * 24 * 30.4375 * 12))).toFixed(2)%></td>                                
                                                                                
                                                  </tr>
                                                    <%years.forEach((year,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=year%></td>    
                                                        <td><%=formatter.format(yearBalance[index])%></td>    
                                                        <td><%=(yearBalance[index]*100/(element.expense - investment)).toFixed(2)%></td>                                
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                    </div>
                                    <p>*Excludes Investments</p>
                                         </div>
                                         </li>
                            <%}%>
                            <%
                            months = []
                           balance = []
                           years = []
                           yearBalance = []
                           yearTran = 0
                           Tran = 0
                           element.activity.filter(entry => (((entry.isActive == true && year == entry.tstamp.getFullYear())))).forEach(entry => {
                             yearTran += 1
                             if(!months.includes(entry.tstamp.getMonth())){
                              months.push(entry.tstamp.getMonth())
                                 balance.push(0)
                             }
                             if(months.includes(entry.tstamp.getMonth())){
                             i = months.indexOf(entry.tstamp.getMonth())
                                 balance[i] += 1
                                 }                
                           })
                           element.activity.filter(entry => (((entry.isActive == true)))).forEach(entry => {
                            Tran += 1
                            if(!years.includes(entry.tstamp.getFullYear())){
                         years.push(entry.tstamp.getFullYear())
                            yearBalance.push(0)
                        }
                        if(years.includes(entry.tstamp.getFullYear())){
                        i = years.indexOf(entry.tstamp.getFullYear())
                            yearBalance[i] += 1
                            }
                        
                      })
                            %>

                            <li>
                              <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">import_export</i>Periodwise Transactions</h5></div>
                              <div class="collapsible-body">
                                    <div class="row">
                                      <%yearGrid = "s6" %>
                                      <%if(yearlyExpense < 0){%>
                                      <div class="col <%=yearGrid%>">
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th><%=year%>
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Month</th>
                                                      <th>Count</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                            
                                                            
                                                    <%months.forEach((month,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=monthCart[month]%></td>    
                                                        <td><%=(balance[index])%></td>    
                                                        <td><%=(balance[index]*100/(yearTran)).toFixed(2)%></td>
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                      <%}%>
                                      <%Grid = "s6"
                                      if(yearlyExpense >= 0)
                                      {
                                        Grid = "s12"
                                      }
                                      %>
                                      <div class="col <%=Grid%>">
                            
                                        <table class="striped centered responsive-table">
                                          <thead>
                                                    <tr>
                                                        <th>Lifetime
                                              <hr>
                                              </th>                    
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                        <table class="striped centered responsive-table" style="margin-top:-30px">      
                                                  <thead>
                                                    <tr>
                                                      <th>Year</th>
                                                      <th>Count</th>
                                                      <th>Percent</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <%years.forEach((year,index) => {%>
                                                    <tr style="font-weight:500;">
                                                        <td><%=year%></td>    
                                                        <td><%=(yearBalance[index])%></td>    
                                                        <td><%=(yearBalance[index]*100/(Tran)).toFixed(2)%></td>                                
                                                      <%})%>                              
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </tbody>
                                              </table>
                                      </div>
                                    </div>
                                    <p>*Excludes Investments</p>
                                         </div>
                                         </li>
                                         <%
              
              categories = []
              balance = []
              monthlycategories = []
              monthlybalance = []
              yearlycategories = []
              yearlybalance = []
              Total = 0
              monthTotal = 0
              yearTotal = 0
              element.activity.filter(entry => (entry.isActive == true)).forEach(entry => {
                Total += 1
                if(!categories.includes(entry.category)){
                 categories.push(entry.category)
                    balance.push(0)
                }
                if(categories.includes(entry.category)){
                i = categories.indexOf(entry.category)
                    balance[i] += 1
                    }
              })
              
              element.activity.filter(entry => (entry.isActive == true && (month == entry.tstamp.getMonth() && year == entry.tstamp.getFullYear()))).forEach(entry => {
                monthTotal += 1
                if(!monthlycategories.includes(entry.category)){
                 monthlycategories.push(entry.category)
                    monthlybalance.push(0)
                }
                if(monthlycategories.includes(entry.category)){
                i = monthlycategories.indexOf(entry.category)
                    monthlybalance[i] += 1
                    }
              })

              element.activity.filter(entry => (entry.isActive == true && (year == entry.tstamp.getFullYear()))).forEach(entry => {
                yearTotal += 1
                if(!yearlycategories.includes(entry.category)){
                 yearlycategories.push(entry.category)
                    yearlybalance.push(0)
                }
                if(yearlycategories.includes(entry.category)){
                i = yearlycategories.indexOf(entry.category)
                    yearlybalance[i] += 1
                    }
              })
              %>  
              <li>
                <div class="collapsible-header"><h5 style="margin-top:0.5%;margin-bottom: 0.5%;"><i class="large material-icons">swap_horiz</i>Categorywise Transactions</h5></div>
                <div class="collapsible-body">
                  <div class="row">
                    <%if(monthlyIncome > 0){%>
                    <div class="col s4">
                      <table class="striped centered responsive-table">
                        <thead>
                                  <tr>
                                      <th><%=monthCart[month]%>
                            <hr>
                            </th>                    
                                  </tr>
                                </thead>
                                <tbody>
                      <table class="striped centered responsive-table" style="margin-top:-30px">      
                                <thead>
                                  <tr>
                                      <th>Category</th>
                                      <th>Count</th>
                                      <th>Percent</th>
                                      
                                  </tr>
                                </thead>
                                <tbody>
          
                                          
                                  <%monthlycategories.forEach((monthlycategory,index) => {%>
                                  <tr style="font-weight:500;">
                                      <td><%=monthlycategory%></td>    
                                      <td><%=monthlybalance[index]%></td>    
                                      <td><%=(monthlybalance[index]*100/monthTotal).toFixed(2)%></td>
                                    <%})%>                              
                                  </tr>
                                </tbody>
                              </table>
                            </tbody>
                            </table>
                    </div><%}%>
                    <%yearGrid = "s4"
                    if(monthlyIncome <= 0)
                    {
                      yearGrid = "s6"
                    }
                    %>
                    <%if(yearlyIncome > 0){%>
                    <div class="col <%=yearGrid%>">
                      <table class="striped centered responsive-table">
                        <thead>
                                  <tr>
                                      <th><%=year%>
                            <hr>
                            </th>                    
                                  </tr>
                                </thead>
                                <tbody>
                      <table class="striped centered responsive-table" style="margin-top:-30px">      
                                <thead>
                                  <tr>
                                    <th>Category</th>
                                    <th>Count</th>
                                    <th>Percent</th>
                                  </tr>
                                </thead>
                                <tbody>
          
                                          
                                  <%yearlycategories.forEach((yearlycategory,index) => {%>
                                  <tr style="font-weight:500;">
                                      <td><%=yearlycategory%></td>    
                                      <td><%=yearlybalance[index]%></td>    
                                      <td><%=(yearlybalance[index]*100/yearTotal).toFixed(2)%></td>
                                    <%})%>                              
                                  </tr>
                                </tbody>
                              </table>
                            </tbody>
                            </table>
                    </div>
                    <%}%>
                    <%Grid = "s4"
                    if(monthlyIncome <= 0)
                    {
                      Grid = "s6"
                    }
                    if(yearlyIncome <= 0)
                    {
                      Grid = "s12"
                    }
                    %>
                    <div class="col <%=Grid%>">
          
                      <table class="striped centered responsive-table">
                        <thead>
                                  <tr>
                                      <th>Lifetime
                            <hr>
                            </th>                    
                                  </tr>
                                </thead>
                                <tbody>
                      <table class="striped centered responsive-table" style="margin-top:-30px">      
                                <thead>
                                  <tr>
                                    <th>Category</th>
                                    <th>Count</th>
                                    <th>Percent</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <%categories.forEach((category,index) => {%>
                                  <tr style="font-weight:500;">
                                      <td><%=category%></td>    
                                      <td><%=balance[index]%></td>    
                                      <td><%=(balance[index]*100/Total).toFixed(2)%></td>                                
                                    <%})%>                              
                                  </tr>
                                </tbody>
                              </table>
                            </tbody>
                            </table>
                    </div>
                  </div>
                       </div>
                                </li>
                 </ul>
              </div>
              <div id = "logout" class="modal white bottom-sheet">
                <h5 class="header center light-blue-text text-darken-4" style="font-family:Roboto;">Do you want to log out of the App?</h5>
                <a class="modal-close waves-effect waves-grey btn-flat right" style="top: -45px;"><i class="material-icons">close</i></a>
                <div class="row">
                  <form action="/account?_method=PUT" method="POST">
                    <div class="input-field">
                      <input name = "action" type="hidden" placeholder = "Account Name" class="validate" required="" aria-required="true" value = "logout">
                    </div>
                    <div class="input-field col s6 offset-s3 left center" style="width: 50%;">
                      <input class="btn light-blue darken-4 white-text" value="Yes" type="submit">
                      <a class="modal-close btn light-blue darken-4 white-text">No</a>
                    </div>
                    </form>
                  </div>
                  <h6 id="warning" style="font-family:Roboto;" class="center red-text"></h6>
                    <!--<script>
                      if((window.fullScreen) ||
                 (window.innerWidth == screen.width && window.innerHeight == screen.height)) {
                   console.log("FullScreen");
              }else{
                document.getElementById('warning').innerHTML = "Warning<br>Pressing YES Will Close All The Tabs!<br>Close The Current Tab Instead By Pressing CTRL+W";
              }
                    </script>-->
              </div>
              
              
              <div id = "chperiod" class="modal white">
                <h5 class="header center light-blue-text text-darken-4" style="font-family:Roboto;">Change Period</h5>
    <a class="modal-close waves-effect waves-grey btn-flat right" style="top: -45px;"><i class="material-icons">close</i></a>
    <div class="row">
      <form action="/account/pivots?_method=PUT" method="POST">
        <div class="input-field">
          <input name = "id" type="hidden" class="validate" required="" aria-required="true" value = "<%=element._id %>">
        </div>
        <div class="input-field col s5 offset-s1 center">
          <select name = "month" class="browser-default" style="margin-top:7px;">
          <%for(i = 0;i < 12;i++){%>
          <option value="<%=i+1%>" <%= month == i?'selected':''%>><%=monthCart[i]%></option>
        <%}%>
        </select>
        </div>
        <%
        yearCart = []
      count = new Date().getFullYear() - element.tcreate.getFullYear()
      for(i = 0;i<=count;i++){
        yearCart.push(new Date().getFullYear()-i)
      }
        %>
        
        <div class="input-field col s5 center">
          <select name = "year" class="browser-default" style="margin-top:7px;">
          <%yearCart.forEach(year => {%>
          <option value="<%=year%>"><%=year%> </option>
        <%})%>
        </select>
        </div>
        <div class="input-field col s6 offset-s3 left center" style="width: 50%;">
          <input class="btn light-blue darken-4 white-text" value="CHANGE" type="submit">
        </div>
        </form>
      </div>
    </div>            

    <%})%>